<!DOCTYPE html>
<html lang="ko">
<head>
    <!-- Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-YXJSQD3KBJ"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-YXJSQD3KBJ');
    </script>

    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title data-i18n="diffPageTitle">Diff ë¹„êµê¸° - ionflow.xyz</title>
    <meta name="description" data-i18n="diffPageDesc" content="í…ìŠ¤íŠ¸ì™€ ì½”ë“œë¥¼ ë¹„êµí•˜ê³  ì°¨ì´ì ì„ ì‹œê°ì ìœ¼ë¡œ í™•ì¸í•˜ì„¸ìš”. ë¬´ë£Œ ì˜¨ë¼ì¸ Diff ë„êµ¬.">

    <link rel="canonical" href="https://ionflow.xyz/tools/diff.html">
    <meta property="og:type" content="website">
    <meta property="og:site_name" content="ionflow.xyz">
    <meta property="og:title" content="Diff ë¹„êµê¸° - ionflow.xyz">
    <meta property="og:description" content="í…ìŠ¤íŠ¸ì™€ ì½”ë“œë¥¼ ë¹„êµí•˜ê³  ì°¨ì´ì ì„ ì‹œê°ì ìœ¼ë¡œ í™•ì¸í•˜ì„¸ìš”. ë¬´ë£Œ ì˜¨ë¼ì¸ Diff ë„êµ¬.">
    <meta property="og:url" content="https://ionflow.xyz/tools/diff.html">
    <meta property="og:image" content="https://ionflow.xyz/assets/images/og-image.png">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="Diff ë¹„êµê¸° - ionflow.xyz">
    <meta name="twitter:description" content="í…ìŠ¤íŠ¸ì™€ ì½”ë“œë¥¼ ë¹„êµí•˜ê³  ì°¨ì´ì ì„ ì‹œê°ì ìœ¼ë¡œ í™•ì¸í•˜ì„¸ìš”.">
    <meta name="twitter:image" content="https://ionflow.xyz/assets/images/og-image.png">
    <link rel="alternate" hreflang="ko" href="https://ionflow.xyz/tools/diff.html">
    <link rel="alternate" hreflang="en" href="https://ionflow.xyz/tools/diff.html?lang=en">
    <link rel="alternate" hreflang="x-default" href="https://ionflow.xyz/tools/diff.html">
    <link rel="icon" type="image/svg+xml" href="/assets/images/favicon.svg">
    <link rel="apple-touch-icon" href="/assets/images/apple-touch-icon.png">
    <link rel="preconnect" href="https://pagead2.googlesyndication.com">
    <link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin>
    <link rel="preconnect" href="https://fonts.googleapis.com" crossorigin>

    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-3465506500903274"
        crossorigin="anonymous"></script>

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.9/dist/web/static/pretendard.min.css">
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="/assets/css/common.css">

    <style>
        :root {
            --added-bg: #e6ffec;
            --added-highlight: #abf2bc;
            --removed-bg: #ffebe9;
            --removed-highlight: #ff8182;
            --changed-bg: #fff8c5;
            --line-number-bg: #f6f8fa;
            --line-number-color: #6e7681;
            --border-color: #d0d7de;
        }

        main { max-width: 1400px; }

        .input-section {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 24px;
        }

        .input-panel {
            background: #f5f5f7;
            border-radius: 18px;
            padding: 20px;
        }

        .input-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }

        .input-title {
            font-size: 15px;
            font-weight: 600;
            color: #1d1d1f;
        }

        .input-actions {
            display: flex;
            gap: 8px;
        }

        .small-btn {
            padding: 6px 12px;
            background: #e8e8ed;
            border: none;
            border-radius: 6px;
            font-size: 12px;
            cursor: pointer;
            transition: background 0.2s;
        }
        .small-btn:hover { background: #d2d2d7; }

        .text-input {
            width: 100%;
            height: 280px;
            padding: 14px;
            border: 1px solid #d2d2d7;
            border-radius: 12px;
            font-family: 'JetBrains Mono', monospace;
            font-size: 13px;
            line-height: 1.6;
            resize: none;
            background: #fff;
        }
        .text-input:focus { outline: none; border-color: #86868b; }

        .controls {
            display: flex;
            gap: 12px;
            align-items: center;
            flex-wrap: wrap;
            margin-bottom: 24px;
        }

        .compare-btn {
            padding: 14px 32px;
            background: #1d1d1f;
            color: #fff;
            border: none;
            border-radius: 12px;
            font-size: 15px;
            font-weight: 500;
            cursor: pointer;
            transition: background 0.2s;
        }
        .compare-btn:hover { background: #424245; }

        .view-toggle {
            display: flex;
            background: #e8e8ed;
            border-radius: 8px;
            overflow: hidden;
        }
        .view-btn {
            padding: 10px 16px;
            border: none;
            background: transparent;
            font-size: 13px;
            cursor: pointer;
            transition: all 0.2s;
        }
        .view-btn.active {
            background: #1d1d1f;
            color: #fff;
        }

        .options-group {
            display: flex;
            gap: 16px;
            align-items: center;
        }
        .option-label {
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 13px;
            color: #6e6e73;
            cursor: pointer;
        }
        .option-label input { width: 16px; height: 16px; }

        /* Statistics */
        .stats-bar {
            display: flex;
            gap: 24px;
            padding: 16px 20px;
            background: #f5f5f7;
            border-radius: 12px;
            margin-bottom: 20px;
        }
        .stat-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .stat-badge {
            width: 12px;
            height: 12px;
            border-radius: 3px;
        }
        .stat-badge.added { background: #2da44e; }
        .stat-badge.removed { background: #cf222e; }
        .stat-badge.changed { background: #bf8700; }
        .stat-label { font-size: 13px; color: #6e6e73; }
        .stat-value { font-size: 15px; font-weight: 600; color: #1d1d1f; }

        /* Diff Output */
        .diff-container {
            background: #fff;
            border: 1px solid var(--border-color);
            border-radius: 12px;
            overflow: hidden;
            margin-bottom: 24px;
        }

        .diff-header {
            display: flex;
            background: #f6f8fa;
            border-bottom: 1px solid var(--border-color);
            font-size: 13px;
            font-weight: 500;
        }
        .diff-header-left,
        .diff-header-right {
            flex: 1;
            padding: 12px 16px;
        }
        .diff-header-right {
            border-left: 1px solid var(--border-color);
        }

        .diff-content {
            overflow-x: auto;
        }

        /* Side-by-side view */
        .diff-table {
            width: 100%;
            border-collapse: collapse;
            table-layout: fixed;
            font-family: 'JetBrains Mono', monospace;
            font-size: 13px;
            line-height: 1.5;
        }

        .diff-table td {
            padding: 0;
            vertical-align: top;
        }

        .diff-table td:nth-child(1),
        .diff-table td:nth-child(3) { width: 50px; }
        .diff-table td:nth-child(2),
        .diff-table td:nth-child(4) { width: calc(50% - 50px); }

        .line-num {
            width: 50px;
            min-width: 50px;
            padding: 2px 12px;
            text-align: right;
            background: var(--line-number-bg);
            color: var(--line-number-color);
            border-right: 1px solid var(--border-color);
            user-select: none;
            font-size: 12px;
        }

        .line-content {
            padding: 2px 12px;
            white-space: pre-wrap;
            word-break: break-all;
        }

        .side-left { border-right: 1px solid var(--border-color); }
        .side-left .line-content { border-right: 1px solid var(--border-color); }

        .line-added { background: var(--added-bg); }
        .line-added .line-num { background: #ccffd8; }
        .line-removed { background: var(--removed-bg); }
        .line-removed .line-num { background: #ffd7d5; }
        .empty-cell { background: #f6f8fa; }

        .highlight-add {
            background: var(--added-highlight);
            border-radius: 2px;
        }
        .highlight-remove {
            background: var(--removed-highlight);
            border-radius: 2px;
        }

        /* Unified view */
        .unified-line {
            display: flex;
            border-bottom: 1px solid #f0f0f0;
        }
        .unified-line:last-child { border-bottom: none; }
        .unified-line .line-num {
            width: 40px;
            min-width: 40px;
        }
        .unified-line .line-content {
            flex: 1;
        }
        .unified-line .line-prefix {
            width: 24px;
            min-width: 24px;
            text-align: center;
            color: var(--line-number-color);
            background: var(--line-number-bg);
            border-right: 1px solid var(--border-color);
            font-weight: 500;
        }
        .unified-line.added .line-prefix { color: #1a7f37; }
        .unified-line.removed .line-prefix { color: #cf222e; }

        /* Inline view */
        .inline-view .diff-row {
            display: flex;
            border-bottom: 1px solid #f0f0f0;
        }
        .inline-view .line-num { width: 60px; }

        /* Empty state */
        .empty-state {
            padding: 60px 20px;
            text-align: center;
            color: #86868b;
        }
        .empty-state .icon {
            font-size: 48px;
            margin-bottom: 16px;
            opacity: 0.5;
        }
        .empty-state p { font-size: 15px; }

        /* No diff state */
        .no-diff {
            padding: 40px 20px;
            text-align: center;
            background: #f0fff4;
            border-radius: 12px;
        }
        .no-diff .icon {
            font-size: 48px;
            margin-bottom: 12px;
        }
        .no-diff h3 {
            font-size: 17px;
            font-weight: 600;
            margin-bottom: 8px;
            color: #1a7f37;
        }
        .no-diff p { font-size: 14px; color: #6e6e73; }

        /* Action buttons */
        .action-buttons {
            display: flex;
            gap: 12px;
            margin-bottom: 24px;
        }
        .action-btn {
            padding: 10px 16px;
            background: #e8e8ed;
            border: none;
            border-radius: 8px;
            font-size: 13px;
            cursor: pointer;
            transition: background 0.2s;
        }
        .action-btn:hover { background: #d2d2d7; }
        .action-btn.primary {
            background: #1d1d1f;
            color: #fff;
        }
        .action-btn.primary:hover { background: #424245; }

        /* Info section */
        .info-section {
            background: #f5f5f7;
            border-radius: 18px;
            padding: 28px;
        }
        .info-section h2 {
            font-size: 21px;
            font-weight: 600;
            margin-bottom: 20px;
        }
        .feature-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 24px;
        }
        .feature-item {
            text-align: center;
        }
        .feature-item .icon {
            font-size: 32px;
            margin-bottom: 12px;
        }
        .feature-item h3 {
            font-size: 15px;
            font-weight: 600;
            margin-bottom: 8px;
        }
        .feature-item p {
            font-size: 13px;
            color: #86868b;
            line-height: 1.5;
        }

        @media (max-width: 1024px) {
            .input-section { grid-template-columns: 1fr; }
            .text-input { height: 200px; }
            .feature-grid { grid-template-columns: 1fr; }
        }

        @media (max-width: 768px) {
            .controls { flex-direction: column; align-items: stretch; }
            .view-toggle { justify-content: center; }
            .options-group { justify-content: center; }
            .stats-bar { flex-wrap: wrap; gap: 16px; }
            .diff-header { display: none; }
        }
    </style>
</head>
<body>
    <div class="page-header">
        <h1 data-i18n="diffHeading">Diff ë¹„êµê¸°</h1>
        <p data-i18n="diffSubheading">ë‘ í…ìŠ¤íŠ¸ì˜ ì°¨ì´ì ì„ ì‹œê°ì ìœ¼ë¡œ ë¹„êµí•©ë‹ˆë‹¤</p>
    </div>

    <main>
        <div id="status" class="status"></div>

        <div class="input-section">
            <div class="input-panel">
                <div class="input-header">
                    <span class="input-title" data-i18n="diffOriginal">ì›ë³¸ í…ìŠ¤íŠ¸</span>
                    <div class="input-actions">
                        <button class="small-btn" onclick="loadSample('original')" data-i18n="diffSampleBtn">ìƒ˜í”Œ</button>
                        <button class="small-btn" onclick="clearInput('original')" data-i18n="diffClearBtn">ì§€ìš°ê¸°</button>
                        <button class="small-btn" onclick="pasteInput('original')" data-i18n="diffPasteBtn">ë¶™ì—¬ë„£ê¸°</button>
                    </div>
                </div>
                <textarea id="original-text" class="text-input" data-i18n-placeholder="diffOriginalPlaceholder" placeholder="ì›ë³¸ í…ìŠ¤íŠ¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”..."></textarea>
            </div>

            <div class="input-panel">
                <div class="input-header">
                    <span class="input-title" data-i18n="diffModified">ìˆ˜ì •ëœ í…ìŠ¤íŠ¸</span>
                    <div class="input-actions">
                        <button class="small-btn" onclick="loadSample('modified')" data-i18n="diffSampleBtn">ìƒ˜í”Œ</button>
                        <button class="small-btn" onclick="clearInput('modified')" data-i18n="diffClearBtn">ì§€ìš°ê¸°</button>
                        <button class="small-btn" onclick="pasteInput('modified')" data-i18n="diffPasteBtn">ë¶™ì—¬ë„£ê¸°</button>
                    </div>
                </div>
                <textarea id="modified-text" class="text-input" data-i18n-placeholder="diffModifiedPlaceholder" placeholder="ìˆ˜ì •ëœ í…ìŠ¤íŠ¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”..."></textarea>
            </div>
        </div>

        <div class="controls">
            <button class="compare-btn" onclick="compareDiff()" data-i18n="diffCompareBtn">ë¹„êµí•˜ê¸°</button>

            <div class="view-toggle">
                <button class="view-btn active" data-view="split" onclick="setView('split')" data-i18n="diffViewSplit">ë‚˜ë€íˆ</button>
                <button class="view-btn" data-view="unified" onclick="setView('unified')" data-i18n="diffViewUnified">í†µí•©</button>
            </div>

            <div class="options-group">
                <label class="option-label">
                    <input type="checkbox" id="ignore-whitespace">
                    <span data-i18n="diffIgnoreWhitespace">ê³µë°± ë¬´ì‹œ</span>
                </label>
                <label class="option-label">
                    <input type="checkbox" id="ignore-case">
                    <span data-i18n="diffIgnoreCase">ëŒ€ì†Œë¬¸ì ë¬´ì‹œ</span>
                </label>
            </div>
        </div>

        <div class="stats-bar" id="stats-bar" style="display: none;">
            <div class="stat-item">
                <span class="stat-badge added"></span>
                <span class="stat-label" data-i18n="diffAdded">ì¶”ê°€</span>
                <span class="stat-value" id="stat-added">0</span>
            </div>
            <div class="stat-item">
                <span class="stat-badge removed"></span>
                <span class="stat-label" data-i18n="diffRemoved">ì‚­ì œ</span>
                <span class="stat-value" id="stat-removed">0</span>
            </div>
            <div class="stat-item">
                <span class="stat-badge changed"></span>
                <span class="stat-label" data-i18n="diffChanged">ë³€ê²½</span>
                <span class="stat-value" id="stat-changed">0</span>
            </div>
            <div class="stat-item">
                <span class="stat-label" data-i18n="diffTotalLines">ì´ ë¼ì¸</span>
                <span class="stat-value" id="stat-total">0</span>
            </div>
        </div>

        <div class="diff-container" id="diff-container">
            <div class="empty-state" id="empty-state">
                <div class="icon">â‡„</div>
                <p data-i18n="diffEmptyState">í…ìŠ¤íŠ¸ë¥¼ ì…ë ¥í•˜ê³  ë¹„êµí•˜ê¸° ë²„íŠ¼ì„ í´ë¦­í•˜ì„¸ìš”</p>
            </div>
        </div>

        <div class="action-buttons" id="action-buttons" style="display: none;">
            <button class="action-btn" onclick="copyDiff()" data-i18n="diffCopyBtn">ì°¨ì´ì  ë³µì‚¬</button>
            <button class="action-btn" onclick="downloadDiff()" data-i18n="diffDownloadBtn">ê²°ê³¼ ë‹¤ìš´ë¡œë“œ</button>
            <button class="action-btn" onclick="swapTexts()" data-i18n="diffSwapBtn">í…ìŠ¤íŠ¸ êµí™˜</button>
        </div>

        <div class="ad-space" data-i18n="ad">ê´‘ê³ </div>

        <div class="info-section">
            <h2 data-i18n="diffInfoTitle">Diff ë¹„êµê¸° ì‚¬ìš©ë²•</h2>
            <div class="feature-grid">
                <div class="feature-item">
                    <div class="icon">ğŸ“</div>
                    <h3 data-i18n="diffFeature1Title">í…ìŠ¤íŠ¸ ì…ë ¥</h3>
                    <p data-i18n="diffFeature1Desc">ì›ë³¸ê³¼ ìˆ˜ì •ëœ í…ìŠ¤íŠ¸ë¥¼ ê°ê° ì…ë ¥í•˜ê±°ë‚˜ ë¶™ì—¬ë„£ê¸° í•©ë‹ˆë‹¤</p>
                </div>
                <div class="feature-item">
                    <div class="icon">ğŸ”</div>
                    <h3 data-i18n="diffFeature2Title">ì •ë°€í•œ ë¹„êµ</h3>
                    <p data-i18n="diffFeature2Desc">ë¬¸ì ë‹¨ìœ„ë¡œ ë³€ê²½ì‚¬í•­ì„ ê°ì§€í•˜ì—¬ ì •í™•í•œ ì°¨ì´ì ì„ í‘œì‹œí•©ë‹ˆë‹¤</p>
                </div>
                <div class="feature-item">
                    <div class="icon">ğŸ“Š</div>
                    <h3 data-i18n="diffFeature3Title">í†µê³„ ì œê³µ</h3>
                    <p data-i18n="diffFeature3Desc">ì¶”ê°€, ì‚­ì œ, ë³€ê²½ëœ ë¼ì¸ ìˆ˜ë¥¼ í•œëˆˆì— í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤</p>
                </div>
            </div>
        </div>
    </main>

    <script>
        // LCS-based diff algorithm
        function computeLCS(a, b) {
            const m = a.length, n = b.length;
            const dp = Array(m + 1).fill(null).map(() => Array(n + 1).fill(0));

            for (let i = 1; i <= m; i++) {
                for (let j = 1; j <= n; j++) {
                    if (a[i - 1] === b[j - 1]) {
                        dp[i][j] = dp[i - 1][j - 1] + 1;
                    } else {
                        dp[i][j] = Math.max(dp[i - 1][j], dp[i][j - 1]);
                    }
                }
            }
            return dp;
        }

        function backtrackDiff(dp, a, b, i, j) {
            const result = [];
            while (i > 0 || j > 0) {
                if (i > 0 && j > 0 && a[i - 1] === b[j - 1]) {
                    result.unshift({ type: 'equal', oldLine: i - 1, newLine: j - 1, value: a[i - 1] });
                    i--; j--;
                } else if (j > 0 && (i === 0 || dp[i][j - 1] >= dp[i - 1][j])) {
                    result.unshift({ type: 'add', newLine: j - 1, value: b[j - 1] });
                    j--;
                } else {
                    result.unshift({ type: 'remove', oldLine: i - 1, value: a[i - 1] });
                    i--;
                }
            }
            return result;
        }

        function diffLines(original, modified, ignoreWhitespace, ignoreCase) {
            let oldLines = original.split('\n');
            let newLines = modified.split('\n');

            if (ignoreWhitespace) {
                oldLines = oldLines.map(l => l.trim());
                newLines = newLines.map(l => l.trim());
            }
            if (ignoreCase) {
                oldLines = oldLines.map(l => l.toLowerCase());
                newLines = newLines.map(l => l.toLowerCase());
            }

            const originalLines = original.split('\n');
            const modifiedLines = modified.split('\n');

            const dp = computeLCS(oldLines, newLines);
            const rawDiff = backtrackDiff(dp, oldLines, newLines, oldLines.length, newLines.length);

            // Map back to original text
            return rawDiff.map(item => {
                if (item.type === 'equal') {
                    return { ...item, value: originalLines[item.oldLine] };
                } else if (item.type === 'remove') {
                    return { ...item, value: originalLines[item.oldLine] };
                } else {
                    return { ...item, value: modifiedLines[item.newLine] };
                }
            });
        }

        // Character-level diff for highlighting
        function diffChars(oldStr, newStr) {
            const dp = computeLCS(oldStr.split(''), newStr.split(''));
            return backtrackDiff(dp, oldStr.split(''), newStr.split(''), oldStr.length, newStr.length);
        }

        function highlightCharDiff(oldStr, newStr) {
            const charDiff = diffChars(oldStr, newStr);
            let oldHtml = '', newHtml = '';

            for (const item of charDiff) {
                const escaped = escapeHtml(item.value);
                if (item.type === 'equal') {
                    oldHtml += escaped;
                    newHtml += escaped;
                } else if (item.type === 'remove') {
                    oldHtml += `<span class="highlight-remove">${escaped}</span>`;
                } else {
                    newHtml += `<span class="highlight-add">${escaped}</span>`;
                }
            }

            return { oldHtml, newHtml };
        }

        function escapeHtml(str) {
            return str
                .replace(/&/g, '&amp;')
                .replace(/</g, '&lt;')
                .replace(/>/g, '&gt;')
                .replace(/"/g, '&quot;')
                .replace(/'/g, '&#039;')
                .replace(/ /g, '&nbsp;')
                .replace(/\t/g, '&nbsp;&nbsp;&nbsp;&nbsp;');
        }

        let currentDiff = null;
        let currentView = 'split';

        function setView(view) {
            currentView = view;
            document.querySelectorAll('.view-btn').forEach(btn => {
                btn.classList.toggle('active', btn.dataset.view === view);
            });
            if (currentDiff) {
                renderDiff(currentDiff);
            }
        }

        function compareDiff() {
            const original = document.getElementById('original-text').value;
            const modified = document.getElementById('modified-text').value;
            const ignoreWhitespace = document.getElementById('ignore-whitespace').checked;
            const ignoreCase = document.getElementById('ignore-case').checked;

            if (!original && !modified) {
                showStatus('í…ìŠ¤íŠ¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”', true);
                return;
            }

            currentDiff = diffLines(original, modified, ignoreWhitespace, ignoreCase);

            // Calculate stats
            const stats = { added: 0, removed: 0, changed: 0, total: 0 };
            let i = 0;
            while (i < currentDiff.length) {
                if (currentDiff[i].type === 'remove' &&
                    i + 1 < currentDiff.length &&
                    currentDiff[i + 1].type === 'add') {
                    stats.changed++;
                    i += 2;
                } else if (currentDiff[i].type === 'add') {
                    stats.added++;
                    i++;
                } else if (currentDiff[i].type === 'remove') {
                    stats.removed++;
                    i++;
                } else {
                    i++;
                }
                stats.total++;
            }

            document.getElementById('stat-added').textContent = stats.added;
            document.getElementById('stat-removed').textContent = stats.removed;
            document.getElementById('stat-changed').textContent = stats.changed;
            document.getElementById('stat-total').textContent = stats.total;
            document.getElementById('stats-bar').style.display = 'flex';
            document.getElementById('action-buttons').style.display = 'flex';

            renderDiff(currentDiff);
        }

        function renderDiff(diff) {
            const container = document.getElementById('diff-container');

            if (diff.every(item => item.type === 'equal')) {
                container.innerHTML = `
                    <div class="no-diff">
                        <div class="icon">âœ“</div>
                        <h3 data-i18n="diffNoChanges">ì°¨ì´ì  ì—†ìŒ</h3>
                        <p data-i18n="diffIdentical">ë‘ í…ìŠ¤íŠ¸ê°€ ë™ì¼í•©ë‹ˆë‹¤</p>
                    </div>
                `;
                return;
            }

            if (currentView === 'split') {
                renderSplitView(diff, container);
            } else {
                renderUnifiedView(diff, container);
            }
        }

        function renderSplitView(diff, container) {
            let html = `
                <div class="diff-header">
                    <div class="diff-header-left" data-i18n="diffOriginal">ì›ë³¸</div>
                    <div class="diff-header-right" data-i18n="diffModified">ìˆ˜ì •ë¨</div>
                </div>
                <div class="diff-content">
                    <table class="diff-table"><tbody>
            `;

            // Group consecutive removes and adds together for better alignment
            const groups = [];
            let i = 0;
            while (i < diff.length) {
                if (diff[i].type === 'equal') {
                    groups.push({ type: 'equal', items: [diff[i]] });
                    i++;
                } else {
                    // Collect consecutive removes and adds (in any order)
                    const removes = [];
                    const adds = [];
                    while (i < diff.length && (diff[i].type === 'remove' || diff[i].type === 'add')) {
                        if (diff[i].type === 'remove') {
                            removes.push(diff[i]);
                        } else {
                            adds.push(diff[i]);
                        }
                        i++;
                    }
                    if (removes.length > 0 || adds.length > 0) {
                        groups.push({ type: 'change', removes, adds });
                    }
                }
            }

            let oldLineNum = 0, newLineNum = 0;

            for (const group of groups) {
                if (group.type === 'equal') {
                    const item = group.items[0];
                    html += `
                        <tr>
                            <td class="line-num side-left">${++oldLineNum}</td>
                            <td class="line-content side-left">${escapeHtml(item.value)}</td>
                            <td class="line-num">${++newLineNum}</td>
                            <td class="line-content">${escapeHtml(item.value)}</td>
                        </tr>
                    `;
                } else {
                    const { removes, adds } = group;
                    const maxLen = Math.max(removes.length, adds.length);

                    for (let j = 0; j < maxLen; j++) {
                        const removeItem = removes[j];
                        const addItem = adds[j];

                        // If both exist on same row, show character diff
                        if (removeItem && addItem) {
                            const { oldHtml, newHtml } = highlightCharDiff(removeItem.value, addItem.value);
                            html += `
                                <tr>
                                    <td class="line-num side-left line-removed">${++oldLineNum}</td>
                                    <td class="line-content side-left line-removed">${oldHtml || '&nbsp;'}</td>
                                    <td class="line-num line-added">${++newLineNum}</td>
                                    <td class="line-content line-added">${newHtml || '&nbsp;'}</td>
                                </tr>
                            `;
                        } else if (removeItem) {
                            html += `
                                <tr>
                                    <td class="line-num side-left line-removed">${++oldLineNum}</td>
                                    <td class="line-content side-left line-removed">${escapeHtml(removeItem.value) || '&nbsp;'}</td>
                                    <td class="line-num empty-cell"></td>
                                    <td class="line-content empty-cell"></td>
                                </tr>
                            `;
                        } else if (addItem) {
                            html += `
                                <tr>
                                    <td class="line-num side-left empty-cell"></td>
                                    <td class="line-content side-left empty-cell"></td>
                                    <td class="line-num line-added">${++newLineNum}</td>
                                    <td class="line-content line-added">${escapeHtml(addItem.value) || '&nbsp;'}</td>
                                </tr>
                            `;
                        }
                    }
                }
            }

            html += '</tbody></table></div>';
            container.innerHTML = html;
        }

        function renderUnifiedView(diff, container) {
            let html = '<div class="diff-content">';

            const original = document.getElementById('original-text').value.split('\n');
            const modified = document.getElementById('modified-text').value.split('\n');

            let oldLineNum = 0, newLineNum = 0;

            for (const item of diff) {
                if (item.type === 'equal') {
                    oldLineNum++;
                    newLineNum++;
                    html += `
                        <div class="unified-line">
                            <div class="line-num">${oldLineNum}</div>
                            <div class="line-num">${newLineNum}</div>
                            <div class="line-prefix">&nbsp;</div>
                            <div class="line-content">${escapeHtml(item.value)}</div>
                        </div>
                    `;
                } else if (item.type === 'remove') {
                    oldLineNum++;
                    html += `
                        <div class="unified-line removed line-removed">
                            <div class="line-num">${oldLineNum}</div>
                            <div class="line-num"></div>
                            <div class="line-prefix">âˆ’</div>
                            <div class="line-content">${escapeHtml(item.value) || '&nbsp;'}</div>
                        </div>
                    `;
                } else if (item.type === 'add') {
                    newLineNum++;
                    html += `
                        <div class="unified-line added line-added">
                            <div class="line-num"></div>
                            <div class="line-num">${newLineNum}</div>
                            <div class="line-prefix">+</div>
                            <div class="line-content">${escapeHtml(item.value) || '&nbsp;'}</div>
                        </div>
                    `;
                }
            }

            html += '</div>';
            container.innerHTML = html;
        }

        function showStatus(msg, isError = false) {
            const s = document.getElementById('status');
            s.textContent = msg;
            s.className = 'status show' + (isError ? ' error' : '');
            setTimeout(() => s.classList.remove('show'), 3000);
        }

        function clearInput(type) {
            document.getElementById(type === 'original' ? 'original-text' : 'modified-text').value = '';
        }

        async function pasteInput(type) {
            try {
                const text = await navigator.clipboard.readText();
                document.getElementById(type === 'original' ? 'original-text' : 'modified-text').value = text;
            } catch (e) {
                showStatus('ë¶™ì—¬ë„£ê¸° ì‹¤íŒ¨', true);
            }
        }

        function loadSample(type) {
            const samples = {
                original: `function hello(name) {
    console.log("Hello, " + name);
    return true;
}

const result = hello("World");
console.log(result);`,
                modified: `function greet(name, greeting = "Hello") {
    console.log(greeting + ", " + name + "!");
    return { success: true, message: greeting };
}

const result = greet("World", "Hi");
console.log(result.message);`
            };
            document.getElementById(type === 'original' ? 'original-text' : 'modified-text').value = samples[type];
        }

        function swapTexts() {
            const original = document.getElementById('original-text');
            const modified = document.getElementById('modified-text');
            const temp = original.value;
            original.value = modified.value;
            modified.value = temp;
            if (currentDiff) {
                compareDiff();
            }
        }

        function copyDiff() {
            if (!currentDiff) return;

            let text = '';
            for (const item of currentDiff) {
                if (item.type === 'equal') {
                    text += '  ' + item.value + '\n';
                } else if (item.type === 'remove') {
                    text += '- ' + item.value + '\n';
                } else if (item.type === 'add') {
                    text += '+ ' + item.value + '\n';
                }
            }

            navigator.clipboard.writeText(text).then(() => {
                showStatus('ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤');
            });
        }

        function downloadDiff() {
            if (!currentDiff) return;

            let text = '=== Diff Result ===\n\n';
            for (const item of currentDiff) {
                if (item.type === 'equal') {
                    text += '  ' + item.value + '\n';
                } else if (item.type === 'remove') {
                    text += '- ' + item.value + '\n';
                } else if (item.type === 'add') {
                    text += '+ ' + item.value + '\n';
                }
            }

            const blob = new Blob([text], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'diff-result.txt';
            a.click();
            URL.revokeObjectURL(url);
            showStatus('ë‹¤ìš´ë¡œë“œ ì‹œì‘');
        }
    </script>
    <script src="/assets/js/i18n.js?v=4"></script>
    <script src="/assets/js/layout.js?v=3"></script>
</body>
</html>
